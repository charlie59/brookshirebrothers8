<div{{ content_attributes.addClass('store-locator-results') }}>

  {% if items.total == 0 %}
    <p>There are no stores within {{ items.distance }} miles of {{ items.zipCode }}. Please <a href="/store-locator">try
        your search again.</a>
    </p>
  {% else %}
    <p>We found {{ items.total }} store{% if items.total > 1 %}s{% endif %} within {{ items.distance }} miles
      of {{ items.zipCode }} | <a href="/store-locator">Search Again</a>
    </p>


    <div id="map">Map</div>

    <script>
      // Initialize and add the map
      function initMap() {

        let elCentro = {lat: {{ items.latLong.lat }}, lng: {{ items.latLong.lng }}};
        let infoWindow = new google.maps.InfoWindow();
        let map = new google.maps.Map(
          document.getElementById('map'), {
            zoom: 18,
            center: elCentro,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            imageDefaultUI: true
          });
        let service = new google.maps.places.PlacesService(map);

        let request = {
          query: '86MW+86 Lufkin, Texas',
          fields: ['name', 'geometry'],
        };

        service.findPlaceFromQuery(request, function (results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            for (let i = 0; i < results.length; i++) {
              createMarker(results[i]);
            }
            map.setCenter(results[0].geometry.location);
          }
        });

        function createMarker(place) {
          let marker = new google.maps.Marker({
            map: map,
            position: place.geometry.location,
          });

          google.maps.event.addListener(marker, 'click', function() {
            infoWindow.setContent('Brookshire Brothers');
            infoWindow.open(map, this);
          });
        }

      }
    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAQNRPaZd4ibswz8dB7gpOZyajfvtkRaAI&libraries=places&callback=initMap"></script>

    <div id="results">
      {% for store in items.stores %}
        <div class="store">
          <h1>{{ loop.index }}</h1>
          {{ drupal_entity('node', store.nid, 'teaser') }}
        </div>
      {% endfor %}
    </div>

  {% endif %}

</div>
